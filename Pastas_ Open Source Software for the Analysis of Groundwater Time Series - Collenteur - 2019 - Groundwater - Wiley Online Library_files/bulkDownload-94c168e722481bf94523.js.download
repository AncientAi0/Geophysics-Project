(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{301:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return i}));var n=s(10),o=s.n(n),a=s(11),l=s.n(a),i=function(){function BulkDownload(){var e=this;o()(this,BulkDownload),this.classList={hidden:"hidden",error:"error",eventDisabled:"event-disabled",show:"js--show",loader:"js--loader",jsHidden:"js--hidden",aheadOfPrint:"aheadOfPrint",sectionHeader:"section__header",issueItem:"issue-item",moved:"js--moved",focusCycleWrapper:"js--focusCycleWrapper"},this.selectors={section:".bulk-download",wrappers:".bulkDownloadWrapper",modal:".bulk-download-modal",modalHeader:".modal__header",modalActiveBody:".js--show[data-wizard-box]",modalActiveFooter:".js--show[data-wizard-footer]",maxPdfElement:"[data-max-pdf]",hasPdfElement:'[data-has-pdf="true"]',bulkDownloadOption:".bulk-download-option",pdfDownloadTargetOption:'.bulk-download-option[data-target="#pdfDownload"]',bulkDownloadInput:".bulkDownloadInput",bulkWizard:".bulk-wizard",exportCitationsSubmitButton:".export-citations__submit",pdfDownloadSubmitButton:".pdfDownload__submit",exportCitationsForm:".exportCitationsForm",exportCitationInner:".exportCitationInner",focusableElements:'a, button, input:not([type="hidden"]), textarea, select, details, [tabindex]:not([tabindex="-1"])',focusOrderElement:"[data-focus-order]",bulkFocusableEl:".js--bulkFocusableEl",anchorTags:".bulk-download [href='#'],.modal__footer [href='#']"},this.elements={section:null,wrappers:null,modal:null,maxPdfElement:null,hasPdfElement:null,bulkDownloadOption:null,pdfDownloadTargetOption:null,bulkDownloadInput:null,bulkWizard:null,exportCitationsSubmitButton:null,pdfDownloadSubmitButton:null,exportCitationsForm:null,currentWizardBox:null,currentWizardFooter:null,exportCitationInner:null,focusableList:null,anchorTags:null},this.clearModalContent=function(){return e.elements.exportCitationInner.forEach((function(e){return e.innerHTML=""}))},this.downloadOptionHandler=function(t){var s=t.currentTarget.dataset.target,n=e.elements.modal.querySelector(s);n.setAttribute("tabindex","-1");var o,a="",l="",i="",c="",r="";switch(s){case"#exportCitation":e.isPdf=!1,o=n.querySelector(".exportCitationWrapper");break;case"#pdfDownload":e.isPdf=!0,o=n.querySelector(".pdfDownloadWrapper")}e.pdfAccessNum=0;var d=o.querySelector(".bulk-content");e.elements.wrappers.length&&!d&&(e.articleNum=0,e.elements.wrappers.forEach((function(t){if(t.classList.contains(e.classList.aheadOfPrint)){Array.from(t.children).forEach((function(t){if(t.classList.contains(e.classList.sectionHeader)){var s=t.textContent;i+='<h5 class="bulk-content__header">'.concat(s,"</h5>")}else t.classList.contains(e.classList.issueItem)&&(l=e.doiRender(t.querySelector(".bulkDownloadInput"),l),i+=l,l="")}))}else{var s=t.querySelector(".section__header");a=s?'<h5 class="bulk-content__header">'.concat(s.textContent,"</h5>"):"",l="",t.querySelectorAll(".bulkDownloadInput").forEach((function(t){return l=e.doiRender(t,l)})),i+='\n                        <div class="bulk-content">\n                            '.concat(a,"\n                            ").concat(l,"\n                        </div>")}})),e.isPdf&&(e.pdfAccessNum<e.articleNum?e.articleNum<=e.maxPdfItems?(e.isPdfAccessNote=!0,r="\n                            <div>\n                                <div>You only have access to download <b>".concat(e.pdfAccessNum,"</b> of the <b>").concat(e.articleNum,"</b> ").concat(e.contentTypeText," in this list.</div>\n                            </div>")):e.articleNum>e.maxPdfItems&&(e.isPdfAccessNote=!0,r="\n                            <div>\n                                <div><b>This issue contains a large number of articles.</b> Please select up to ".concat(e.maxPdfItems," items for download.</div>\n                                <div>You only have access to download <b>").concat(e.pdfAccessNum,"</b> of the <b>").concat(e.articleNum,"</b> ").concat(e.contentTypeText," in this list.</div>\n                            </div>")):e.pdfAccessNum>=e.articleNum&&e.pdfAccessNum>e.maxPdfItems&&(e.isPdfAccessNote=!0,r="\n                            <div>\n                                <div><b>This issue contains a large number of articles.</b> Please select up to ".concat(e.maxPdfItems," items for download.</div>\n                            </div>")),e.isPdfAccessNote&&(r='\n                        <div class="pdfAccessNote">\n                            <i aria-hidden="true" class="icon-info2"></i>\n                            '.concat(r,"\n                        </div>")),e.isPdfAccessNote=!1),c+=r,c+=i,o.children.length||(o.innerHTML=c,e.focusCycle(!0)),n.querySelector(".selection-count__details").innerHTML="0 of ".concat(e.articleNum," ").concat(e.contentTypeText))},this.bulkInputHandler=function(t){if("bulkDownload"===t.target.name){var s=t.target,n=s.closest(".modal__dialog"),o=n.querySelectorAll('[name="'.concat(s.name,'"]:checked')),a=n.querySelector(".pdfMaxLimit"),l=n.querySelector(".selection-count"),i=l.querySelector(".selection-count__icon"),c=l.querySelector(".selection-count__reached"),r=l.querySelector(".selection-count__details"),d=s.closest(".pdfDownloadWrapper")?n.querySelector(".pdfDownload__submit"):n.querySelector(".exportCitationsForm");r.innerHTML="<b>".concat(o.length," of ").concat(e.articleNum,"</b> ").concat(e.contentTypeText),o.length>=1?(d.classList.contains(e.classList.loader)||("A"===d.tagName&&d.classList.remove(e.classList.eventDisabled),d.removeAttribute("disabled")),s.closest(".pdfDownloadWrapper")?(a&&a.parentElement.removeChild(a),o.length>e.maxPdfItems?(s.checked=!1,s.closest(".bulkDownloadCheckbox").insertAdjacentHTML("afterend",'<div class="pdfMaxLimit"><b>Item limit reached.</b> Please deselect another choice.</div>'),l.classList.add(e.classList.error),r.innerHTML="<b>".concat(o.length-1," of ").concat(e.articleNum,"</b> ").concat(e.contentTypeText)):o.length===e.maxPdfItems?(l.classList.add(e.classList.error),c.classList.remove(e.classList.hidden)):o.length<e.maxPdfItems&&(c.classList.add(e.classList.hidden),i.classList.add(e.classList.hidden),l.classList.remove(e.classList.error))):(l.classList.remove(e.classList.error),i.classList.add(e.classList.hidden))):(d.classList.contains(e.classList.loader)||("A"===d.tagName&&d.classList.add(e.classList.eventDisabled),d.setAttribute("disabled","false")),l.classList.add(e.classList.error),i.classList.remove(e.classList.hidden)),e.focusCycle(!1)}},this.wizardHandler=function(t){var s=t.currentTarget.dataset.wizard,n=e.elements.modal.querySelector('[data-wizard-box="'.concat(s,'"]')),o=e.elements.modal.querySelector('[data-wizard-footer="'.concat(s,'"]'));e.elements.currentWizardBox.classList.remove(e.classList.show),n.classList.add(e.classList.show),e.elements.currentWizardFooter.classList.remove(e.classList.show),o.classList.add(e.classList.show),e.elements.currentWizardBox=n,e.elements.currentWizardFooter=o,e.focusCycle(!0)},this.collectContent=function(e,t){var s,n=t.querySelector(".collectContent"),o=t.querySelector(".collectContentNum"),a=0;n.textContent="",o.textContent="",e.forEach((function(e){var t='<input type="hidden" name="doi" value="'.concat(e.value,'"/>');n.insertAdjacentHTML("beforeend",t),a++})),s=a>1?"s":"",o.innerHTML="<p>You have chosen to export <span>".concat(a,"</span> citation").concat(s,".</p>")},this.doiRender=function(t,s){var n=t.nextElementSibling.firstElementChild,o=n.querySelector(".MathJax"),a=n.querySelector(".smallCaps"),l=t.querySelector('[type="hidden"]'),i="true"===l.dataset.hasPdf,c=t.querySelector(".hidden").textContent.trim(),r="",d=!1,u="";switch(u=null!==o||null!==a?n.innerHTML:n.textContent,c){case"full":c="full access",r="full-access";break;case"free":c="free access",r="free-access";break;case"oa":c="open access",r="open-access";break;case"freeToRead":c="Free to Read",r="free-to-read-access",d=!0;break;case"limited":c="token access",r="token-access",!1,d=!0;break;default:c="",d=!0}return s+='\n            <div class="bulk-content__article">\n            '.concat(""!==c?'\n                <div class="bulk-content__access-type '.concat(r,'">\n                    <i aria-hidden="true" class="icon-icon-lock_open"></i>\n                    <span class="small">').concat(c,"</span>\n                </div>"):"",'\n                <div class="bulk-content__details">\n                    <div class="input-group bulkDownloadCheckbox').concat(!d&&i||!e.isPdf?"":" disabled-content",'">\n                        <label class="checkbox--primary">\n                            <input title="title" type="checkbox" name="bulkDownload" value="').concat(l.value,'" ').concat(!d&&i||!e.isPdf?"":"disabled",'>\n                            <span class="label-txt">\n                                <div class="bulk-content__title">').concat(u,"</div>\n                            </span>\n                        </label>\n                    </div>\n                </div>\n            </div>"),i&&!d&&e.pdfAccessNum++,e.articleNum++,s},this.collectContentHandler=function(t){var s=e.elements.modal.querySelector(t.currentTarget.dataset.wrapper),n=e.elements.modal.querySelector(t.currentTarget.dataset.form),o=s.querySelectorAll('[name="bulkDownload"]:checked');e.collectContent(o,n)},this.exportCitationsSubmitButton=function(t){t.preventDefault();var s=t.currentTarget;e.elements.modal.querySelector(s.dataset.form).submit()},this.pdfDownloadSubmit=function(t){var s=t.currentTarget,n=s.querySelector("span"),o=e.elements.section.querySelector('[data-target="#pdfDownload"]').dataset.ajax,a=s.closest(".modal__dialog").querySelectorAll('[name="bulkDownload"]:checked'),l=s.previousElementSibling.querySelector(".selection-count__error"),i="",c=0;t.preventDefault(),l.classList.add(e.classList.hidden),s.setAttribute("disabled",!0),s.classList.add(e.classList.loader),s.classList.add(e.classList.eventDisabled),n.textContent="Preparing download",a.forEach((function(e){0===c&&(i+="?"),i+="doi=".concat(e.value,"&"),c++})),i=o+i.slice(0,-1),fetch(i).then((function(e){return e})).then((function(t){switch(t.headers.get("download-status")){case"full_access":var o=t.headers.get("content-disposition").replace("attachment; filename=","");t.blob().then((function(e){var t=document.createElement("a"),s=window.URL.createObjectURL(e);t.href=s,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)}));break;default:e.downloadButtonErrorReset(l,t.headers.get("download-status"))}e.resetDownloadButton(s,n)})).catch((function(e){console.log(e)}))},this.resetDownloadButton=function(t,s){t.removeAttribute("disabled"),t.classList.remove(e.classList.loader),t.classList.remove(e.classList.eventDisabled),s.textContent="Download (.zip)"},this.downloadButtonErrorReset=function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="";switch(s){case"partial_access":n="You do not have a required license. Some publications cannot be downloaded.";break;case"no_access":n="You do not have the required license. No publication will be downloaded.";break;default:n="Something went wrong, Please try again later."}t.classList.remove(e.classList.hidden),t.textContent=n},this.focusCycle=function(t){var s=document.querySelector(e.selectors.bulkFocusableEl),n=e.elements.modal.querySelectorAll(e.selectors.focusOrderElement);s||e.elements.modal.insertAdjacentHTML("afterend",'<div class="js--bulkFocusableEl" aria-hidden="true" tabindex="0">test</div>'),n.forEach((function(e){return e.removeAttribute("data-focus-order")})),e.elements.focusableList=e.focusableElements,e.elements.focusableList.forEach((function(t,s){t.dataset.focusOrder=s,t.addEventListener("focusout",e.focusCycleHandler)})),t&&e.elements.focusableList[0].focus()},this.focusCycleHandler=function(t){t.stopImmediatePropagation();var s=t.target.dataset.focusOrder;if(t.relatedTarget&&!t.relatedTarget.closest(e.selectors.modal))switch(s){case"0":e.elements.focusableList[e.elements.focusableList.length-1].focus();break;case"".concat(e.elements.focusableList.length-1):e.elements.focusableList[0].focus()}},this.init()}return l()(BulkDownload,[{key:"setElements",value:function setElements(){this.elements.wrappers=document.querySelectorAll(this.selectors.wrappers),this.elements.modal=document.querySelector(this.selectors.modal),this.elements.maxPdfElement=this.elements.section.querySelector(this.selectors.maxPdfElement),this.elements.hasPdfElement=document.querySelectorAll(this.selectors.hasPdfElement),this.elements.bulkDownloadOption=document.querySelectorAll(this.selectors.bulkDownloadOption),this.elements.pdfDownloadTargetOption=document.querySelector(this.selectors.pdfDownloadTargetOption),this.elements.bulkDownloadInput=document.querySelectorAll(this.selectors.bulkDownloadInput),this.elements.bulkWizard=this.elements.modal.querySelectorAll(this.selectors.bulkWizard),this.elements.exportCitationsSubmitButton=this.elements.modal.querySelector(this.selectors.exportCitationsSubmitButton),this.elements.pdfDownloadSubmitButton=this.elements.modal.querySelector(this.selectors.pdfDownloadSubmitButton),this.elements.exportCitationsForm=this.elements.modal.querySelector(this.selectors.exportCitationsForm),this.elements.currentWizardBox=this.elements.modal.querySelector(".".concat(this.classList.show,"[data-wizard-box]")),this.elements.currentWizardFooter=this.elements.modal.querySelector(".".concat(this.classList.show,"[data-wizard-footer]")),this.elements.exportCitationInner=this.elements.modal.querySelectorAll(this.selectors.exportCitationInner),this.elements.anchorTags=document.querySelectorAll(this.selectors.anchorTags)}},{key:"init",value:function init(){var e=document.querySelector(".bulk-download");e&&(this.elements.section=e,this.removeOldModal(),this.setElements(),this.initConfig(),this.onReady(),this.eventListeners())}},{key:"removeOldModal",value:function removeOldModal(){var e;null===(e=document.querySelector("".concat(this.selectors.modal,".").concat(this.classList.moved)))||void 0===e||e.remove()}},{key:"setContentTypeText",value:function setContentTypeText(){switch(this.contentType){case"articles":this.contentTypeText="articles";break;case"articlesAndChapters":this.contentTypeText="articles/chapters"}}},{key:"initConfig",value:function initConfig(){this.contentType=this.elements.section.dataset.contentType||"",this.contentTypeText="",this.isPdf="",this.maxPdfItems=this.elements.maxPdfElement?parseInt(this.elements.maxPdfElement.dataset.maxPdf):0,this.articleNum=0,this.pdfAccessNum=0,this.isPdfAccessNote=!1,this.setContentTypeText()}},{key:"onReady",value:function onReady(){var e=this;this.elements.modal.classList.contains(this.classList.moved)||(document.body.appendChild(this.elements.modal),this.elements.modal.classList.add(this.classList.moved)),this.clearModalContent(),this.elements.hasPdfElement.length&&this.elements.hasPdfElement.forEach((function(t){var s=t.nextElementSibling.innerHTML.indexOf("full"),n=t.nextElementSibling.innerHTML.indexOf("free"),o=t.nextElementSibling.innerHTML.indexOf("oa");s||n||o||e.elements.pdfDownloadTargetOption.classList.remove(e.classList.hidden)})),this.elements.bulkDownloadInput.length&&this.elements.section.classList.remove(this.classList.jsHidden)}},{key:"eventListeners",value:function eventListeners(){var e,t=this;this.elements.bulkDownloadOption.forEach((function(e){return e.addEventListener("click",t.downloadOptionHandler)})),this.elements.modal.addEventListener("change",this.bulkInputHandler),this.elements.bulkWizard.forEach((function(e){return e.addEventListener("click",t.wizardHandler)})),this.elements.exportCitationsSubmitButton.addEventListener("click",this.exportCitationsSubmitButton),this.elements.exportCitationsForm.addEventListener("click",this.collectContentHandler),null===(e=this.elements.anchorTags)||void 0===e||e.forEach((function(e){e.addEventListener("click",(function(e){return e.preventDefault(),!1}))})),this.elements.pdfDownloadSubmitButton&&this.elements.pdfDownloadSubmitButton.addEventListener("click",this.pdfDownloadSubmit)}},{key:"focusableElements",get:function get(){var e=this,t=[];return this.elements.modal.querySelectorAll("".concat(this.selectors.modalHeader,", .").concat(this.classList.show,"[data-wizard-footer]")).forEach((function(s){s.querySelectorAll(e.selectors.focusableElements).forEach((function(e){e.disabled||t.push(e)}))})),t}}]),BulkDownload}()}}]);
//# sourceMappingURL=bulkDownload-94c168e722481bf94523.js.map